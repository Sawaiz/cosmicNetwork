<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/google-chart/google-chart.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">


<!--
`cosmic-chart`
Start or stop logging procedure
-->

<dom-module id="cosmic-chart">
  <template>
  <style include="iron-flex iron-flex-alignment"></style>
    <style>
      :host {
        display: block;
      }

      google-chart {
        height: auto;
        min-height: 50vh;
        width: auto;
      }
    </style>

    <google-chart id="cosmicChart" type="scatter" data={{chartData}}></google-chart>   
    
     

    <!--<paper-input label = "Interval" value= {{time}} auto-validate pattern="[0-9.0-9]*" error-message="numbers only!" suffix>
        <div suffix>Seconds</div>
    </paper-input>
    <div class="layout horizontal">
      <paper-button center-justified on-tap="startLogging" raised>Start Logging</paper-button>
      <paper-button center-justified on-tap="stopLogging" raised>Stop Logging</paper-button>
    </div>
      <paper-toast id="toast" text="[[data.sucsess]] [[data.error]] [[data.data.filename]]"></paper-toast>-->

    <iron-ajax 
      auto
      id="getChart" 
      url="[[url]]"
      params='[[params]]'
      method = "GET" 
      handle-as="json" 
      on-response="handleResponse"
      debounce-duration="300">
    </iron-ajax>
  </template>

  <script>
    Polymer({

      is: 'cosmic-chart',

      properties: {
        url: {
          type: String,
          computed: "computeURL(alias)",
        },
        alias: {
          type: String,
          value: "lloydWright",
        },
        apiKey: {
          type: String,
          value: null,
        },
        action: {
          type: String,
        },
        data: {
          type: Object,
        },
        params: {
          type: String,
          computed: "computeParams(apiKey)",
        },
      },

      computeURL: function(alias){
        return "/api/db/" + this.alias;
      },

      computeParams: function(time, apiKey){
        var buffer = {};
        buffer.select = {};
        buffer.type = "chart";
        buffer.select.attributes = [];
        buffer.select.attributes.push("createdAt");
        buffer.select.attributes.push("Zero and One");
        buffer.select.attributes.push("Zero and Two");
        buffer.select.attributes.push("One and Two");
        buffer.select = JSON.stringify(buffer.select);
        return buffer;
      },

      handleResponse: function (data) {
        for(item in data.detail.response){
          if(item > 0){
           data.detail.response[item][0] = new Date(Date.parse(data.detail.response[item][0]));
          }
        }
        console.log(data.detail.response);
        this.chartData = data.detail.response;
      },

      startLogging: function(){
        this.action = "beginLog";
        this.$.getChart.generateRequest();
      },
      stopLogging: function(){
        this.action = "stopLog";
        this.$.getChart.generateRequest();
      }

    });

  </script>
</dom-module>